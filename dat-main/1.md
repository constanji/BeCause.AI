# DAT é¡¹ç›®æ¶æ„æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [ä¸€ã€é¡¹ç›®æ¦‚è¿°](#ä¸€é¡¹ç›®æ¦‚è¿°)
- [äºŒã€æ•´ä½“æ¶æ„](#äºŒæ•´ä½“æ¶æ„)
- [ä¸‰ã€æ¨¡å—æ¶æ„](#ä¸‰æ¨¡å—æ¶æ„)
- [å››ã€æ ¸å¿ƒè®¾è®¡æ¨¡å¼](#å››æ ¸å¿ƒè®¾è®¡æ¨¡å¼)
- [äº”ã€æ•°æ®æµè½¬](#äº”æ•°æ®æµè½¬)
- [å…­ã€æ‰©å±•æ€§è®¾è®¡](#å…­æ‰©å±•æ€§è®¾è®¡)
- [ä¸ƒã€æŠ€æœ¯ç‰¹ç‚¹](#ä¸ƒæŠ€æœ¯ç‰¹ç‚¹)
- [å…«ã€ä¾èµ–å…³ç³»](#å…«ä¾èµ–å…³ç³»)
- [ä¹ã€å…³é”®æ¥å£è¯´æ˜](#ä¹å…³é”®æ¥å£è¯´æ˜)
- [åã€é…ç½®ä½“ç³»](#åé…ç½®ä½“ç³»)

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

**DAT (Data Ask Tool)** æ˜¯ä¸€ä¸ªä¼ä¸šçº§æ™ºèƒ½é—®æ•°æ¡†æ¶ï¼Œè‡´åŠ›äºè§£å†³ä¼ä¸šæ•°æ®æŸ¥è¯¢çš„æœ€åä¸€å…¬é‡Œé—®é¢˜â€”â€”è®©ä¸šåŠ¡äººå‘˜èƒ½å¤Ÿç”¨è‡ªç„¶è¯­è¨€ç›´æ¥ä¸æ•°æ®åº“å¯¹è¯ï¼Œæ— éœ€ç¼–å†™å¤æ‚çš„ SQL æŸ¥è¯¢ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **æŠ€æœ¯æ ˆ**: Java 17ã€Mavenã€LangChain4j
- **æ¶æ„æ¨¡å¼**: SPI (Service Provider Interface) + å·¥å‚æ¨¡å¼
- **è®¾è®¡ç†å¿µ**: Framework è€Œé Platformï¼Œæ”¯æŒäºŒæ¬¡å¼€å‘
- **ç‰ˆæœ¬**: 0.7.2

### é¡¹ç›®å®šä½

1. **DAT CLI** - ç”¨äºæœ¬åœ°å¼€å‘ã€å•å…ƒæµ‹è¯•ã€è°ƒè¯•ä½¿ç”¨ï¼Œå°†æç¤ºï¼ˆä¸Šä¸‹æ–‡ï¼‰å·¥ç¨‹è½¬å˜æˆæ•°æ®å·¥ç¨‹
2. **DAT Framework** - äºŒæ¬¡å¼€å‘è€…å¯ä»¥åŸºäº `dat-sdk` å¼€å‘è‡ªå·±çš„ Web UIã€OpenAPI æˆ– MCP æœåŠ¡
3. **å¼€å‘æ¨¡å¼** - è®©æ•°æ®å·¥ç¨‹å¸ˆæˆ–æ•°æ®åˆ†æå¸ˆå¯ä»¥å€Ÿé‰´è½¯ä»¶å·¥ç¨‹å¸ˆå¼€å‘åº”ç”¨ä¸€èˆ¬æ¥å¼€å‘æ™ºèƒ½é—®æ•°åº”ç”¨

---

## äºŒã€æ•´ä½“æ¶æ„

### æ¶æ„åˆ†å±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DAT Framework                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ¯ DAT Language (åˆ›ä½œå±‚)                                    â”‚
â”‚  â”œâ”€â”€ ğŸ“ è¯­ä¹‰æ¨¡å‹å®šä¹‰ (YAML)                                  â”‚
â”‚  â”œâ”€â”€ ğŸ—ƒï¸ æ•°æ®æ¨¡å‹é…ç½®                                         â”‚
â”‚  â””â”€â”€ ğŸ¤– æ™ºèƒ½ä»£ç†é…ç½®                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ DAT Engine (æ‰§è¡Œå±‚)                                      â”‚
â”‚  â”œâ”€â”€ ğŸ”¤ è‡ªç„¶è¯­è¨€ç†è§£   â”‚  ğŸ“Š è¯­ä¹‰SQLç”Ÿæˆ    â”‚  ğŸ—„ï¸ æ•°æ®æŸ¥è¯¢æ‰§è¡Œ  â”‚
â”‚  â”œâ”€â”€ ğŸ§  LLMè°ƒç”¨ç®¡ç†    â”‚  ğŸ” å‘é‡æ£€ç´¢å¢å¼º   â”‚  ğŸ“ˆ ç»“æœæ ¼å¼åŒ–    â”‚
â”‚  â””â”€â”€ ğŸ”Œ SPIç»„ä»¶ç®¡ç†    â”‚  ğŸ­ å·¥å‚æ¨¡å¼åˆ›å»º   â”‚  âš¡ ç¼“å­˜ä¼˜åŒ–     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„ç‰¹ç‚¹

- **åˆ†å±‚è®¾è®¡**: åˆ›ä½œå±‚ï¼ˆé…ç½®ï¼‰ä¸æ‰§è¡Œå±‚ï¼ˆå¼•æ“ï¼‰åˆ†ç¦»
- **å¯æ’æ‹”æ¶æ„**: é€šè¿‡ SPI æœºåˆ¶å®ç°ç»„ä»¶åŠ¨æ€åŠ è½½
- **å·¥å‚æ¨¡å¼**: ç»Ÿä¸€ç»„ä»¶åˆ›å»ºå’Œç®¡ç†
- **é…ç½®é©±åŠ¨**: YAML é…ç½®æ–‡ä»¶é©±åŠ¨æ•´ä¸ªç³»ç»Ÿ

---

## ä¸‰ã€æ¨¡å—æ¶æ„

é¡¹ç›®é‡‡ç”¨ Maven å¤šæ¨¡å—è®¾è®¡ï¼Œå…±åŒ…å« **10 ä¸ªæ ¸å¿ƒæ¨¡å—**ï¼š

### æ¨¡å—æ¦‚è§ˆ

```
dat-parent/
â”œâ”€â”€ â¤ï¸ dat-core/           # æ ¸å¿ƒæ¥å£å’Œå·¥å‚ç®¡ç†
â”œâ”€â”€ ğŸ”Œ dat-adapters/       # æ•°æ®åº“é€‚é…å™¨
â”œâ”€â”€ ğŸ§  dat-llms/          # LLMé›†æˆæ¨¡å—
â”œâ”€â”€ ğŸ“ dat-embedders/     # åµŒå…¥æ¨¡å‹é›†æˆ
â”œâ”€â”€ âš–ï¸ dat-rerankers/     # é‡æ’æ¨¡å‹é›†æˆ
â”œâ”€â”€ ğŸ’¾ dat-storers/       # å‘é‡å­˜å‚¨åç«¯
â”œâ”€â”€ ğŸ¤– dat-agents/        # æ™ºèƒ½ä»£ç†å®ç°
â”œâ”€â”€ ğŸŒ dat-servers/       # æœåŠ¡ç«¯ç»„ä»¶
â”œâ”€â”€ ğŸ“¦ dat-sdk/           # å¼€å‘å·¥å…·åŒ…
â””â”€â”€ ğŸ–¥ï¸ dat-cli/           # å‘½ä»¤è¡Œå·¥å…·
```

### 1. æ ¸å¿ƒæ¨¡å— (dat-core)

**èŒè´£**: å®šä¹‰æ ¸å¿ƒæ¥å£ã€æŠ½è±¡ç±»å’Œå·¥å‚ç®¡ç†

**ä¸»è¦ç»„ä»¶**:

#### å·¥å‚ä½“ç³»
- `Factory` - å·¥å‚åŸºç¡€æ¥å£
- `FactoryManager<T>` - å·¥å‚ç®¡ç†å™¨ï¼ˆæ³›å‹ï¼‰
- `DatabaseAdapterFactory` - æ•°æ®åº“é€‚é…å™¨å·¥å‚æ¥å£
- `ChatModelFactory` - LLM æ¨¡å‹å·¥å‚æ¥å£
- `EmbeddingModelFactory` - åµŒå…¥æ¨¡å‹å·¥å‚æ¥å£
- `ContentStoreFactory` - å†…å®¹å­˜å‚¨å·¥å‚æ¥å£
- `AskdataAgentFactory` - Agent å·¥å‚æ¥å£

#### é€‚é…å™¨ä½“ç³»
- `DatabaseAdapter` - æ•°æ®åº“é€‚é…å™¨æ¥å£
- `SemanticAdapter` - è¯­ä¹‰é€‚é…å™¨æ¥å£
- `GenericSqlDatabaseAdapter` - é€šç”¨ SQL æ•°æ®åº“é€‚é…å™¨æŠ½è±¡ç±»

#### Agent ä½“ç³»
- `AskdataAgent` - é—®æ•° Agent æ¥å£
- `AbstractAskdataAgent` - æŠ½è±¡ Agent åŸºç±»
- `AbstractHitlAskdataAgent` - æ”¯æŒäººæœºäº¤äº’çš„æŠ½è±¡ Agent

#### å†…å®¹å­˜å‚¨ä½“ç³»
- `ContentStore` - å†…å®¹å­˜å‚¨æ¥å£
- `DefaultContentStore` - é»˜è®¤å†…å®¹å­˜å‚¨å®ç°
- `ContentRetriever` - å†…å®¹æ£€ç´¢å™¨

#### è¯­ä¹‰æ¨¡å‹ä½“ç³»
- `SemanticModel` - è¯­ä¹‰æ¨¡å‹
- `Entity` - å®ä½“ï¼ˆä¸»é”®ã€å¤–é”®ç­‰ï¼‰
- `Dimension` - ç»´åº¦ï¼ˆæ—¶é—´ã€åˆ†ç±»ã€æšä¸¾ï¼‰
- `Measure` - åº¦é‡ï¼ˆèšåˆå‡½æ•°ã€è®¡ç®—å­—æ®µï¼‰
- `Element` - å…ƒç´ åŸºç±»

#### é…ç½®ä½“ç³»
- `Configuration` - é…ç½®æ¥å£
- `ReadableConfig` - å¯è¯»é…ç½®æ¥å£
- `ConfigOption` - é…ç½®é€‰é¡¹
- `ConfigOptions` - é…ç½®é€‰é¡¹å·¥å…·ç±»

**å…³é”®ä¾èµ–**:
- LangChain4j - AI æ¡†æ¶
- Apache Calcite - SQL è§£æå’Œè½¬æ¢
- Jinjava - Jinja æ¨¡æ¿å¼•æ“

### 2. æ•°æ®åº“é€‚é…å™¨æ¨¡å— (dat-adapters)

**èŒè´£**: æ•°æ®åº“è¿æ¥ã€SQL æ–¹è¨€è½¬æ¢ã€æ•°æ®æŸ¥è¯¢æ‰§è¡Œ

**æ”¯æŒçš„æ•°æ®åº“**:

| æ¨¡å— | æ•°æ®åº“ | ç‰¹ç‚¹ |
|------|--------|------|
| `dat-adapter-duckdb` | DuckDB | æœ¬åœ°å†…ç½®æ•°æ®åº“ï¼Œæ”¯æŒ CSV å¯¼å…¥ |
| `dat-adapter-mysql` | MySQL | å®Œæ•´æ”¯æŒï¼ŒåŒ…å«è¿æ¥æ± å’Œæ–¹è¨€è½¬æ¢ |
| `dat-adapter-postgresql` | PostgreSQL | ä¼ä¸šçº§æ•°æ®åº“æ”¯æŒ |
| `dat-adapter-oracle` | Oracle | ä¼ ç»Ÿä¼ä¸šæ•°æ®åº“å…¼å®¹ |

**æ ¸å¿ƒåŠŸèƒ½**:
- æ•°æ®åº“è¿æ¥ç®¡ç†
- SQL æ–¹è¨€è½¬æ¢ï¼ˆè¯­ä¹‰ SQL â†’ çœŸå® SQLï¼‰
- æŸ¥è¯¢æ‰§è¡Œå’Œç»“æœå¤„ç†
- å…ƒæ•°æ®è·å–ï¼ˆè¡¨ç»“æ„ã€åˆ—ä¿¡æ¯ï¼‰
- ç§å­æ•°æ®åˆå§‹åŒ–

### 3. LLM é›†æˆæ¨¡å— (dat-llms)

**èŒè´£**: å¤§è¯­è¨€æ¨¡å‹é›†æˆï¼Œç”¨äºè‡ªç„¶è¯­è¨€ç†è§£å’Œ SQL ç”Ÿæˆ

**æ”¯æŒçš„ LLM**:

| æ¨¡å— | æä¾›å•† | ç‰¹ç‚¹ |
|------|--------|------|
| `dat-llm-openai` | OpenAI | GPT ç³»åˆ—æ¨¡å‹ |
| `dat-llm-anthropic` | Anthropic | Claude ç³»åˆ—æ¨¡å‹ |
| `dat-llm-gemini` | Google | Gemini ç³»åˆ—æ¨¡å‹ |
| `dat-llm-ollama` | Ollama | æœ¬åœ°éƒ¨ç½²æ¨¡å‹ |
| `dat-llm-xinference` | Xinference | å¼€æºæ¨ç†æ¡†æ¶ |
| `dat-llm-azure-openai` | Azure | Azure OpenAI æœåŠ¡ |

**æ ¸å¿ƒåŠŸèƒ½**:
- è‡ªç„¶è¯­è¨€ç†è§£
- è¯­ä¹‰ SQL ç”Ÿæˆ
- æ„å›¾åˆ†ç±»
- å¯¹è¯ç®¡ç†

### 4. åµŒå…¥æ¨¡å‹æ¨¡å— (dat-embedders)

**èŒè´£**: æ–‡æœ¬å‘é‡åŒ–ï¼Œç”¨äºè¯­ä¹‰æ£€ç´¢

**æ”¯æŒçš„æ¨¡å‹**:

| æ¨¡å— | æ¨¡å‹ | ç‰¹ç‚¹ |
|------|------|------|
| `dat-embedder-bge-small-zh` | BGE Small ZH | æœ¬åœ°å†…ç½®ï¼Œä¸­æ–‡ä¼˜åŒ– |
| `dat-embedder-bge-small-zh-q` | BGE Small ZH Quantized | é‡åŒ–ç‰ˆæœ¬ï¼Œæ›´å°æ›´å¿« |
| `dat-embedder-bge-small-zh-v15` | BGE Small ZH v1.5 | æ–°ç‰ˆæœ¬ |
| `dat-embedder-bge-small-zh-v15-q` | BGE Small ZH v1.5 Quantized | é‡åŒ–ç‰ˆæœ¬ |
| `dat-embedder-openai` | OpenAI | text-embedding-ada-002 ç­‰ |
| `dat-embedder-ollama` | Ollama | æœ¬åœ°éƒ¨ç½² |
| `dat-embedder-jina` | Jina AI | å¤šè¯­è¨€æ”¯æŒ |
| `dat-embedder-xinference` | Xinference | å¼€æºæ¨ç†æ¡†æ¶ |
| `dat-embedder-azure-openai` | Azure | Azure OpenAI æœåŠ¡ |

**æ ¸å¿ƒåŠŸèƒ½**:
- æ–‡æœ¬å‘é‡åŒ–
- æ‰¹é‡åµŒå…¥
- è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—

### 5. é‡æ’æ¨¡å‹æ¨¡å— (dat-rerankers)

**èŒè´£**: æ£€ç´¢ç»“æœé‡æ’åºï¼Œæå‡æ£€ç´¢ç²¾åº¦

**æ”¯æŒçš„æ¨¡å‹**:

| æ¨¡å— | æ¨¡å‹ | ç‰¹ç‚¹ |
|------|------|------|
| `dat-reranker-ms-marco-minilm-l6-v2` | MS MARCO MiniLM | æœ¬åœ°å†…ç½® |
| `dat-reranker-ms-marco-minilm-l6-v2-q` | MS MARCO MiniLM Quantized | é‡åŒ–ç‰ˆæœ¬ |
| `dat-reranker-ms-marco-tinybert-l2-v2` | MS MARCO TinyBERT | æ›´å°æ›´å¿« |
| `dat-reranker-ms-marco-tinybert-l2-v2-q` | MS MARCO TinyBERT Quantized | é‡åŒ–ç‰ˆæœ¬ |
| `dat-reranker-onnx-local` | ONNX Local | æœ¬åœ° ONNX æ¨¡å‹ |
| `dat-reranker-jina` | Jina AI | äº‘ç«¯æœåŠ¡ |
| `dat-reranker-xinference` | Xinference | å¼€æºæ¨ç†æ¡†æ¶ |

**æ ¸å¿ƒåŠŸèƒ½**:
- æ£€ç´¢ç»“æœé‡æ’åº
- ç›¸å…³æ€§è¯„åˆ†
- æå‡æ£€ç´¢ç²¾åº¦

### 6. å‘é‡å­˜å‚¨æ¨¡å— (dat-storers)

**èŒè´£**: å‘é‡æ•°æ®å­˜å‚¨ä¸æ£€ç´¢

**æ”¯æŒçš„å­˜å‚¨**:

| æ¨¡å— | å­˜å‚¨ | ç‰¹ç‚¹ |
|------|------|------|
| `dat-storer-duckdb` | DuckDB | æœ¬åœ°å†…ç½®ï¼Œè½»é‡çº§ |
| `dat-storer-pgvector` | PGVector | PostgreSQL æ‰©å±• |
| `dat-storer-weaviate` | Weaviate | ä¸“ä¸šå‘é‡æ•°æ®åº“ |
| `dat-storer-qdrant` | Qdrant | é«˜æ€§èƒ½å‘é‡æ•°æ®åº“ |
| `dat-storer-milvus` | Milvus | ä¼ä¸šçº§å‘é‡æ•°æ®åº“ |

**å­˜å‚¨å†…å®¹**:
- è¯­ä¹‰æ¨¡å‹å‘é‡
- SQL é—®ç­”å¯¹å‘é‡
- åŒä¹‰è¯å‘é‡
- ä¸šåŠ¡çŸ¥è¯†å‘é‡

**æ ¸å¿ƒåŠŸèƒ½**:
- å‘é‡å­˜å‚¨å’Œç´¢å¼•
- ç›¸ä¼¼åº¦æ£€ç´¢
- æ‰¹é‡æ“ä½œ
- å†…å®¹ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰

### 7. æ™ºèƒ½ä»£ç†æ¨¡å— (dat-agents)

**èŒè´£**: é—®æ•° Agent å®ç°ï¼Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘

**å½“å‰å®ç°**:
- `dat-agent-agentic` - åŸºäº Agentic æ¶æ„çš„æ™ºèƒ½ä»£ç†

**Agent ç±»å‹**:
- **MainAgent** - ä¸»ä»£ç†ï¼Œåè°ƒå…¶ä»–ä»£ç†
- **Text2SqlAgent** - æ–‡æœ¬è½¬ SQL ä»£ç†
- **DataAssistanceAgent** - æ•°æ®è¾…åŠ©ä»£ç†
- **MisleadingAssistanceAgent** - è¯¯å¯¼æ£€æµ‹ä»£ç†

**æ ¸å¿ƒåŠŸèƒ½**:
- æ„å›¾åˆ†ç±»
- è¯­ä¹‰ SQL ç”Ÿæˆ
- å‘é‡æ£€ç´¢å¢å¼º
- äººæœºäº¤äº’ï¼ˆHITLï¼‰
- å·¥å…·è°ƒç”¨ï¼ˆEmailã€MCP ç­‰ï¼‰

### 8. SDK æ¨¡å— (dat-sdk)

**èŒè´£**: å¼€å‘å·¥å…·åŒ…ï¼Œæä¾›é«˜çº§ API

**ä¸»è¦ç±»**:

#### é¡¹ç›®ç®¡ç†
- `ProjectRunner` - é¡¹ç›®è¿è¡Œå™¨ï¼Œæ‰§è¡Œé—®æ•°
- `ProjectBuilder` - é¡¹ç›®æ„å»ºå™¨ï¼Œæ„å»ºè¯­ä¹‰æ¨¡å‹
- `ProjectSeeder` - ç§å­æ•°æ®åŠ è½½å™¨
- `DatProjectFactory` - é¡¹ç›®å·¥å‚

#### å†…å®¹ç®¡ç†
- `ContentStoreManager` - å†…å®¹å­˜å‚¨ç®¡ç†å™¨
- `BuildStateManager` - æ„å»ºçŠ¶æ€ç®¡ç†å™¨
- `FileChangeAnalyzer` - æ–‡ä»¶å˜æ›´åˆ†æå™¨

#### å·¥å…·ç±»
- `DatProjectUtil` - é¡¹ç›®å·¥å…·ç±»
- `DatSchemaUtil` - Schema å·¥å…·ç±»
- `ProjectUtil` - é¡¹ç›®å·¥å…·ç±»

**æ ¸å¿ƒåŠŸèƒ½**:
- é¡¹ç›®åˆå§‹åŒ–
- è¯­ä¹‰æ¨¡å‹æ„å»º
- å†…å®¹å­˜å‚¨ç®¡ç†
- å¢é‡æ›´æ–°
- ç¼“å­˜ç®¡ç†

### 9. æœåŠ¡ç«¯æ¨¡å— (dat-servers)

**èŒè´£**: å¯¹å¤–æœåŠ¡æ¥å£

**æœåŠ¡ç±»å‹**:

#### OpenAPI æœåŠ¡ (dat-server-openapi)
- RESTful API
- æµå¼é—®ç­”æ”¯æŒ
- Swagger UI æ–‡æ¡£
- æ”¯æŒ Dify æ’ä»¶é›†æˆ

#### MCP æœåŠ¡ (dat-server-mcp)
- Model Context Protocol æ”¯æŒ
- æ”¯æŒ Claude Desktopã€Cline ç­‰ Agent
- æ ‡å‡† MCP æ¥å£

**æ ¸å¿ƒåŠŸèƒ½**:
- HTTP æœåŠ¡
- æµå¼å“åº”
- é”™è¯¯å¤„ç†
- è®¤è¯æˆæƒ

### 10. CLI æ¨¡å— (dat-cli)

**èŒè´£**: å‘½ä»¤è¡Œå·¥å…·

**ä¸»è¦å‘½ä»¤**:

| å‘½ä»¤ | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `dat init` | åˆå§‹åŒ–é¡¹ç›® | åˆ›å»ºæ–°çš„ DAT é¡¹ç›® |
| `dat run` | è¿è¡Œæ™ºèƒ½é—®æ•° | å¯åŠ¨äº¤äº’å¼é—®æ•° |
| `dat server openapi` | å¯åŠ¨ OpenAPI æœåŠ¡ | æä¾› RESTful API |
| `dat server mcp` | å¯åŠ¨ MCP æœåŠ¡ | æä¾› MCP åè®®æœåŠ¡ |
| `dat seed` | åŠ è½½ç§å­æ•°æ® | ä» CSV å¯¼å…¥æ•°æ® |

**æ ¸å¿ƒåŠŸèƒ½**:
- é¡¹ç›®è„šæ‰‹æ¶
- äº¤äº’å¼é—®æ•°
- æœåŠ¡å¯åŠ¨
- æ•°æ®å¯¼å…¥

---

## å››ã€æ ¸å¿ƒè®¾è®¡æ¨¡å¼

### 1. SPI (Service Provider Interface) æœºåˆ¶

**åŸç†**: é€šè¿‡ Java SPI å®ç°å¯æ’æ‹”æ¶æ„ï¼Œç»„ä»¶åœ¨è¿è¡Œæ—¶åŠ¨æ€åŠ è½½

**å®ç°æ–¹å¼**:

1. **å®šä¹‰å·¥å‚æ¥å£** (åœ¨ `dat-core` ä¸­)
```java
public interface DatabaseAdapterFactory extends Factory {
    DatabaseAdapter create(ReadableConfig config);
}
```

2. **å®ç°å·¥å‚ç±»** (åœ¨å„ä¸ªæ¨¡å—ä¸­)
```java
public class MySqlDatabaseAdapterFactory implements DatabaseAdapterFactory {
    @Override
    public String factoryIdentifier() {
        return "mysql";
    }
    
    @Override
    public DatabaseAdapter create(ReadableConfig config) {
        // åˆ›å»º MySQL é€‚é…å™¨
    }
}
```

3. **æ³¨å†ŒæœåŠ¡** (åœ¨ `META-INF/services/` ä¸­)
```
# META-INF/services/ai.dat.core.factories.DatabaseAdapterFactory
ai.dat.adapter.mysql.MySqlDatabaseAdapterFactory
```

4. **å·¥å‚ç®¡ç†å™¨åŠ è½½**
```java
FactoryManager<DatabaseAdapterFactory> manager = 
    new FactoryManager<>(DatabaseAdapterFactory.class, "database adapter");
DatabaseAdapterFactory factory = manager.getFactory("mysql");
```

**ä¼˜åŠ¿**:
- è§£è€¦ï¼šæ¥å£ä¸å®ç°åˆ†ç¦»
- å¯æ‰©å±•ï¼šæ–°å¢å®ç°æ— éœ€ä¿®æ”¹æ ¸å¿ƒä»£ç 
- åŠ¨æ€åŠ è½½ï¼šè¿è¡Œæ—¶å‘ç°å’ŒåŠ è½½ç»„ä»¶

### 2. å·¥å‚æ¨¡å¼

**åº”ç”¨åœºæ™¯**: æ‰€æœ‰ç»„ä»¶çš„åˆ›å»ºéƒ½é€šè¿‡å·¥å‚æ¨¡å¼

**å·¥å‚ç±»å‹**:
- `DatabaseAdapterFactory` - æ•°æ®åº“é€‚é…å™¨
- `ChatModelFactory` - LLM æ¨¡å‹
- `EmbeddingModelFactory` - åµŒå…¥æ¨¡å‹
- `EmbeddingStoreFactory` - å‘é‡å­˜å‚¨
- `ScoringModelFactory` - é‡æ’æ¨¡å‹
- `ContentStoreFactory` - å†…å®¹å­˜å‚¨
- `AskdataAgentFactory` - Agent

**ç»Ÿä¸€ç®¡ç†**:
- `FactoryManager<T>` - æ³›å‹å·¥å‚ç®¡ç†å™¨
- å•ä¾‹æ¨¡å¼ç®¡ç†æ‰€æœ‰å·¥å‚å®ä¾‹
- æä¾›ç»Ÿä¸€çš„è·å–æ¥å£

### 3. é…ç½®é©±åŠ¨

**é…ç½®å±‚æ¬¡**:
1. **é¡¹ç›®é…ç½®** (`dat_project.yaml`)
   - æ•°æ®åº“é…ç½®
   - LLM é…ç½®
   - åµŒå…¥æ¨¡å‹é…ç½®
   - Agent é…ç½®

2. **è¯­ä¹‰æ¨¡å‹é…ç½®** (`models/*.yaml`)
   - å®ä½“å®šä¹‰
   - ç»´åº¦å®šä¹‰
   - åº¦é‡å®šä¹‰

3. **æ•°æ®æ¨¡å‹é…ç½®** (`schemas/*.yaml`)
   - è¡¨ç»“æ„å®šä¹‰
   - è§†å›¾å®šä¹‰
   - Jinja æ¨¡æ¿æ”¯æŒ

**é…ç½®ç‰¹ç‚¹**:
- YAML æ ¼å¼ï¼Œæ˜“äºé˜…è¯»å’Œç¼–è¾‘
- ç±»å‹å®‰å…¨ï¼Œé€šè¿‡ Schema éªŒè¯
- æ”¯æŒå˜é‡æ›¿æ¢ï¼ˆJinja æ¨¡æ¿ï¼‰
- æ”¯æŒå¤šç¯å¢ƒé…ç½®

---

## äº”ã€æ•°æ®æµè½¬

### å®Œæ•´æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·è‡ªç„¶è¯­è¨€é—®é¢˜                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AskdataAgent (æ™ºèƒ½ä»£ç†)                         â”‚
â”‚  â”œâ”€â”€ æ„å›¾åˆ†ç±» (Intent Classification)                       â”‚
â”‚  â”œâ”€â”€ é—®é¢˜ç†è§£ (Question Understanding)                      â”‚
â”‚  â””â”€â”€ ä¸Šä¸‹æ–‡æ„å»º (Context Building)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ContentStore (å†…å®¹å­˜å‚¨ - å‘é‡æ£€ç´¢)                 â”‚
â”‚  â”œâ”€â”€ è¯­ä¹‰æ¨¡å‹æ£€ç´¢ (Semantic Model Retrieval)                â”‚
â”‚  â”œâ”€â”€ SQLé—®ç­”å¯¹æ£€ç´¢ (Q&A Pair Retrieval)                     â”‚
â”‚  â”œâ”€â”€ åŒä¹‰è¯æ£€ç´¢ (Synonym Retrieval)                         â”‚
â”‚  â””â”€â”€ ä¸šåŠ¡çŸ¥è¯†æ£€ç´¢ (Business Knowledge Retrieval)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LLM (å¤§è¯­è¨€æ¨¡å‹)                                â”‚
â”‚  â”œâ”€â”€ è¯­ä¹‰SQLç”Ÿæˆ (Semantic SQL Generation)                  â”‚
â”‚  â”œâ”€â”€ æ¨ç†è¿‡ç¨‹ (Reasoning Process)                           â”‚
â”‚  â””â”€â”€ ç»“æœéªŒè¯ (Result Validation)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        SemanticAdapter (è¯­ä¹‰é€‚é…å™¨)                          â”‚
â”‚  â”œâ”€â”€ è¯­ä¹‰SQLè§£æ (Semantic SQL Parsing)                     â”‚
â”‚  â”œâ”€â”€ æ¨¡å‹ç»‘å®š (Model Binding)                               â”‚
â”‚  â””â”€â”€ çœŸå®SQLç”Ÿæˆ (Real SQL Generation)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        DatabaseAdapter (æ•°æ®åº“é€‚é…å™¨)                         â”‚
â”‚  â”œâ”€â”€ SQLæ–¹è¨€è½¬æ¢ (SQL Dialect Conversion)                   â”‚
â”‚  â”œâ”€â”€ æŸ¥è¯¢æ‰§è¡Œ (Query Execution)                             â”‚
â”‚  â””â”€â”€ ç»“æœå¤„ç† (Result Processing)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç»“æœæ ¼å¼åŒ–è¿”å›                             â”‚
â”‚  â”œâ”€â”€ æ•°æ®æ ¼å¼åŒ– (Data Formatting)                            â”‚
â”‚  â”œâ”€â”€ è‡ªç„¶è¯­è¨€å›ç­” (Natural Language Response)               â”‚
â”‚  â””â”€â”€ æµå¼è¾“å‡º (Streaming Output)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®æ­¥éª¤è¯´æ˜

1. **æ„å›¾åˆ†ç±»**: åˆ¤æ–­ç”¨æˆ·é—®é¢˜æ˜¯æ•°æ®æŸ¥è¯¢ã€æ•°æ®è¾…åŠ©è¿˜æ˜¯å…¶ä»–ç±»å‹
2. **å‘é‡æ£€ç´¢**: ä»å†…å®¹å­˜å‚¨ä¸­æ£€ç´¢ç›¸å…³çš„è¯­ä¹‰æ¨¡å‹ã€SQL é—®ç­”å¯¹ç­‰
3. **è¯­ä¹‰SQLç”Ÿæˆ**: LLM åŸºäºæ£€ç´¢åˆ°çš„ä¸Šä¸‹æ–‡ç”Ÿæˆè¯­ä¹‰ SQL
4. **SQLè½¬æ¢**: å°†è¯­ä¹‰ SQL è½¬æ¢ä¸ºç›®æ ‡æ•°æ®åº“çš„çœŸå® SQL
5. **æŸ¥è¯¢æ‰§è¡Œ**: æ‰§è¡Œ SQL å¹¶è·å–ç»“æœ
6. **ç»“æœæ ¼å¼åŒ–**: å°†æŸ¥è¯¢ç»“æœæ ¼å¼åŒ–ä¸ºè‡ªç„¶è¯­è¨€å›ç­”

---

## å…­ã€æ‰©å±•æ€§è®¾è®¡

### 1. æ•°æ®åº“æ‰©å±•

**æ­¥éª¤**:

1. åˆ›å»ºæ–°æ¨¡å— `dat-adapter-{database}`
2. å®ç° `DatabaseAdapter` æ¥å£
3. å®ç° `DatabaseAdapterFactory` æ¥å£
4. æ³¨å†Œåˆ° SPI (`META-INF/services/ai.dat.core.factories.DatabaseAdapterFactory`)
5. åœ¨ `dat_project.yaml` ä¸­é…ç½®ä½¿ç”¨

**ç¤ºä¾‹**:
```java
public class ClickHouseDatabaseAdapter implements DatabaseAdapter {
    // å®ç°æ¥å£æ–¹æ³•
}

public class ClickHouseDatabaseAdapterFactory implements DatabaseAdapterFactory {
    @Override
    public String factoryIdentifier() {
        return "clickhouse";
    }
    
    @Override
    public DatabaseAdapter create(ReadableConfig config) {
        return new ClickHouseDatabaseAdapter(config);
    }
}
```

### 2. LLM æ‰©å±•

**æ­¥éª¤**:

1. åˆ›å»ºæ–°æ¨¡å— `dat-llm-{provider}`
2. å®ç° `ChatModelFactory` æ¥å£
3. æ³¨å†Œåˆ° SPI
4. åœ¨é…ç½®ä¸­ä½¿ç”¨

### 3. åµŒå…¥æ¨¡å‹æ‰©å±•

**æ­¥éª¤**:

1. åˆ›å»ºæ–°æ¨¡å— `dat-embedder-{model}`
2. å®ç° `EmbeddingModelFactory` æ¥å£
3. æ³¨å†Œåˆ° SPI
4. åœ¨é…ç½®ä¸­ä½¿ç”¨

### 4. Agent æ‰©å±•

**æ­¥éª¤**:

1. åˆ›å»ºæ–°æ¨¡å— `dat-agent-{type}`
2. å®ç° `AskdataAgent` æ¥å£ï¼ˆæˆ–ç»§æ‰¿ `AbstractAskdataAgent`ï¼‰
3. å®ç° `AskdataAgentFactory` æ¥å£
4. æ³¨å†Œåˆ° SPI
5. åœ¨é…ç½®ä¸­ä½¿ç”¨

---

## ä¸ƒã€æŠ€æœ¯ç‰¹ç‚¹

### 1. æ¨¡å—åŒ–è®¾è®¡

- **èŒè´£æ¸…æ™°**: æ¯ä¸ªæ¨¡å—æœ‰æ˜ç¡®çš„èŒè´£è¾¹ç•Œ
- **ä½è€¦åˆ**: æ¨¡å—é—´é€šè¿‡æ¥å£äº¤äº’
- **é«˜å†…èš**: ç›¸å…³åŠŸèƒ½é›†ä¸­åœ¨åŒä¸€æ¨¡å—

### 2. å¯æ’æ‹”æ¶æ„

- **SPI æœºåˆ¶**: è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ç»„ä»¶
- **å·¥å‚æ¨¡å¼**: ç»Ÿä¸€ç»„ä»¶åˆ›å»ºæ–¹å¼
- **é…ç½®é©±åŠ¨**: é€šè¿‡é…ç½®é€‰æ‹©ç»„ä»¶

### 3. é…ç½®åŒ–å¼€å‘

- **YAML é…ç½®**: ç›´è§‚çš„é…ç½®æ–¹å¼
- **Schema éªŒè¯**: ç±»å‹å®‰å…¨çš„é…ç½®
- **æ¨¡æ¿æ”¯æŒ**: Jinja æ¨¡æ¿å®ç°åŠ¨æ€é…ç½®

### 4. æœ¬åœ°åŒ–æ”¯æŒ

- **æœ¬åœ°æ¨¡å‹**: æ”¯æŒæœ¬åœ°éƒ¨ç½²çš„æ¨¡å‹ï¼ˆDuckDBã€BGE ç­‰ï¼‰
- **ç¦»çº¿è¿è¡Œ**: æ— éœ€å¤–éƒ¨æœåŠ¡å³å¯è¿è¡Œ
- **æˆæœ¬æ§åˆ¶**: é™ä½ API è°ƒç”¨æˆæœ¬

### 5. ä¼ä¸šçº§ç‰¹æ€§

- **HITL æ”¯æŒ**: äººæœºäº¤äº’ï¼Œæå‡å‡†ç¡®æ€§
- **æƒé™æ§åˆ¶**: é€šè¿‡ Jinja æ¨¡æ¿å®ç°æ•°æ®æƒé™
- **å¤šç§Ÿæˆ·**: æ”¯æŒå¤šé¡¹ç›®ã€å¤š Agent
- **æµå¼è¾“å‡º**: å®æ—¶è¿”å›ç»“æœ
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

---

## å…«ã€ä¾èµ–å…³ç³»

### æ¨¡å—ä¾èµ–å›¾
```
                    dat-core (æ ¸å¿ƒæ¥å£)
                         â†‘
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
   dat-adapters    dat-llms      dat-embedders
        â”‚                â”‚                â”‚
   dat-rerankers   dat-storers    (å…¶ä»–æ¨¡å—)
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                    dat-agents
                         â†‘
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
     dat-sdk         dat-servers      dat-cli
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    (éƒ½ä¾èµ– dat-sdk)
```

### ä¾èµ–è¯´æ˜

#### æ ¸å¿ƒä¾èµ– (dat-core)
- **æ— ä¸šåŠ¡ä¾èµ–**: `dat-core` æ˜¯çº¯æ¥å£å’ŒæŠ½è±¡ç±»ï¼Œä¸ä¾èµ–ä»»ä½•ä¸šåŠ¡æ¨¡å—
- **æŠ€æœ¯ä¾èµ–**: LangChain4jã€Apache Calciteã€Jinjava

#### é€‚é…å™¨å±‚ä¾èµ–
- **dat-adapters**: ä¾èµ– `dat-core`ï¼Œå®ç°æ•°æ®åº“é€‚é…å™¨æ¥å£
- **dat-llms**: ä¾èµ– `dat-core`ï¼Œå®ç° LLM æ¨¡å‹æ¥å£
- **dat-embedders**: ä¾èµ– `dat-core`ï¼Œå®ç°åµŒå…¥æ¨¡å‹æ¥å£
- **dat-rerankers**: ä¾èµ– `dat-core`ï¼Œå®ç°é‡æ’æ¨¡å‹æ¥å£
- **dat-storers**: ä¾èµ– `dat-core`ï¼Œå®ç°å‘é‡å­˜å‚¨æ¥å£

#### ä¸šåŠ¡å±‚ä¾èµ–
- **dat-agents**: ä¾èµ– `dat-core` + å…¶ä»–æ‰€æœ‰é€‚é…å™¨æ¨¡å—
- **dat-sdk**: ä¾èµ– `dat-core` + `dat-agents` + å…¶ä»–æ¨¡å—ï¼ˆæŒ‰éœ€ï¼‰
- **dat-servers**: ä¾èµ– `dat-sdk`
- **dat-cli**: ä¾èµ– `dat-sdk`

### ä¾èµ–ç®¡ç†åŸåˆ™

1. **å•å‘ä¾èµ–**: æ ¸å¿ƒæ¨¡å—ä¸ä¾èµ–ä¸šåŠ¡æ¨¡å—
2. **æ¥å£éš”ç¦»**: é€šè¿‡æ¥å£å®ç°æ¨¡å—é—´è§£è€¦
3. **æŒ‰éœ€å¼•å…¥**: é€šè¿‡ Maven ä¾èµ–ç®¡ç†ï¼ŒæŒ‰éœ€å¼•å…¥æ¨¡å—
4. **SPI è§£è€¦**: è¿è¡Œæ—¶é€šè¿‡ SPI åŠ è½½å®ç°ï¼Œç¼–è¯‘æ—¶æ— éœ€ä¾èµ–

---

## ä¹ã€å…³é”®æ¥å£è¯´æ˜

### 1. AskdataAgent æ¥å£

**ä½ç½®**: `ai.dat.core.agent.AskdataAgent`

**èŒè´£**: æ™ºèƒ½é—®æ•° Agent çš„æ ¸å¿ƒæ¥å£

**ä¸»è¦æ–¹æ³•**:

```java
public interface AskdataAgent {
    // è·å–å†…å®¹å­˜å‚¨
    ContentStore contentStore();
    
    // è·å–äº‹ä»¶é€‰é¡¹
    Set<EventOption> eventOptions();
    
    // é—®æ•°ï¼ˆæ— å†å²ï¼‰
    StreamAction ask(String question);
    
    // é—®æ•°ï¼ˆå¸¦å†å²ï¼‰
    StreamAction ask(String question, List<QuestionSqlPair> histories);
    
    // äººæœºäº¤äº’ï¼šç”¨æˆ·å“åº”
    default void userResponse(String response);
    
    // äººæœºäº¤äº’ï¼šç”¨æˆ·å®¡æ‰¹
    default void userApproval(Boolean approval);
}
```

**å®ç°ç±»**:
- `AbstractAskdataAgent` - æŠ½è±¡åŸºç±»
- `AbstractHitlAskdataAgent` - æ”¯æŒäººæœºäº¤äº’çš„æŠ½è±¡ç±»
- `AgenticAskdataAgent` - Agentic æ¶æ„å®ç°

### 2. DatabaseAdapter æ¥å£

**ä½ç½®**: `ai.dat.core.adapter.DatabaseAdapter`

**èŒè´£**: æ•°æ®åº“é€‚é…å™¨æ¥å£ï¼Œè´Ÿè´£æ•°æ®åº“è¿æ¥ã€SQL è½¬æ¢å’ŒæŸ¥è¯¢æ‰§è¡Œ

**ä¸»è¦æ–¹æ³•**:

```java
public interface DatabaseAdapter {
    // è·å–è¯­ä¹‰é€‚é…å™¨
    SemanticAdapter semanticAdapter();
    
    // ç”ŸæˆçœŸå® SQLï¼ˆä»è¯­ä¹‰ SQLï¼‰
    String generateSql(String semanticSql, List<SemanticModel> semanticModels);
    
    // æ‰§è¡ŒæŸ¥è¯¢
    List<Map<String, Object>> executeQuery(String sql) throws SQLException;
    
    // è·å–åˆ—å…ƒæ•°æ®
    List<ColumnMetadata> getColumnMetadata(String sql) throws SQLException;
    
    // SQL ç±»å‹è½¬æ¢
    default AnsiSqlType toAnsiSqlType(int columnType, String columnTypeName, 
                                      int precision, int scale);
    
    // Limit å­å¥ç”Ÿæˆ
    String limitClause(int limit);
    
    // åˆå§‹åŒ–è¡¨ï¼ˆç§å­æ•°æ®ï¼‰
    void initTable(Table table, List<List<String>> data) throws SQLException;
}
```

**å®ç°ç±»**:
- `GenericSqlDatabaseAdapter` - é€šç”¨ SQL æ•°æ®åº“é€‚é…å™¨æŠ½è±¡ç±»
- `MySqlDatabaseAdapter` - MySQL å®ç°
- `PostgreSqlDatabaseAdapter` - PostgreSQL å®ç°
- `OracleDatabaseAdapter` - Oracle å®ç°
- `DuckDBDatabaseAdapter` - DuckDB å®ç°

### 3. ContentStore æ¥å£

**ä½ç½®**: `ai.dat.core.contentstore.ContentStore`

**èŒè´£**: å†…å®¹å­˜å‚¨æ¥å£ï¼Œè´Ÿè´£å‘é‡å­˜å‚¨å’Œæ£€ç´¢

**ä¸»è¦åŠŸèƒ½**:

#### è¯­ä¹‰æ¨¡å‹ç®¡ç†
```java
// æ·»åŠ è¯­ä¹‰æ¨¡å‹
String addMdl(SemanticModel semanticModel);
List<String> addMdls(List<SemanticModel> semanticModels);

// æ£€ç´¢è¯­ä¹‰æ¨¡å‹
List<SemanticModel> retrieveMdl(String question);
List<SemanticModel> allMdls();

// è·å–æ£€ç´¢å™¨
ContentRetriever getMdlContentRetriever();

// åˆ é™¤è¯­ä¹‰æ¨¡å‹
void removeMdl(String id);
void removeMdls(Collection<String> ids);
void removeAllMdls();
```

#### SQL é—®ç­”å¯¹ç®¡ç†
```java
// æ·»åŠ  SQL é—®ç­”å¯¹
String addSql(QuestionSqlPair sqlPair);
List<String> addSqls(List<QuestionSqlPair> sqlPairs);

// æ£€ç´¢ SQL é—®ç­”å¯¹
List<QuestionSqlPair> retrieveSql(String question);

// è·å–æ£€ç´¢å™¨
ContentRetriever getSqlContentRetriever();

// åˆ é™¤ SQL é—®ç­”å¯¹
void removeSql(String id);
void removeSqls(Collection<String> ids);
void removeAllSqls();
```

#### åŒä¹‰è¯ç®¡ç†
```java
// æ·»åŠ åŒä¹‰è¯
String addSyn(WordSynonymPair synonymPair);
List<String> addSyns(List<WordSynonymPair> synonymPairs);

// æ£€ç´¢åŒä¹‰è¯
List<WordSynonymPair> retrieveSyn(String question);

// åˆ é™¤åŒä¹‰è¯
void removeSyn(String id);
void removeSyns(Collection<String> ids);
void removeAllSyns();
```

**å®ç°ç±»**:
- `DefaultContentStore` - é»˜è®¤å®ç°

### 4. Factory æ¥å£ä½“ç³»

#### Factory åŸºç¡€æ¥å£

**ä½ç½®**: `ai.dat.core.factories.Factory`

```java
public interface Factory {
    // å·¥å‚æ ‡è¯†ç¬¦
    String factoryIdentifier();
    
    // å¿…éœ€é…ç½®é€‰é¡¹
    Set<ConfigOption<?>> requiredOptions();
    
    // å¯é€‰é…ç½®é€‰é¡¹
    Set<ConfigOption<?>> optionalOptions();
}
```

#### å…·ä½“å·¥å‚æ¥å£

| æ¥å£ | èŒè´£ | åˆ›å»ºå¯¹è±¡ |
|------|------|----------|
| `DatabaseAdapterFactory` | æ•°æ®åº“é€‚é…å™¨å·¥å‚ | `DatabaseAdapter` |
| `ChatModelFactory` | LLM æ¨¡å‹å·¥å‚ | `ChatLanguageModel` |
| `EmbeddingModelFactory` | åµŒå…¥æ¨¡å‹å·¥å‚ | `EmbeddingModel` |
| `EmbeddingStoreFactory` | å‘é‡å­˜å‚¨å·¥å‚ | `EmbeddingStore` |
| `ScoringModelFactory` | é‡æ’æ¨¡å‹å·¥å‚ | `ScoringModel` |
| `ContentStoreFactory` | å†…å®¹å­˜å‚¨å·¥å‚ | `ContentStore` |
| `AskdataAgentFactory` | Agent å·¥å‚ | `AskdataAgent` |

### 5. SemanticModel è¯­ä¹‰æ¨¡å‹

**ä½ç½®**: `ai.dat.core.semantic.data.SemanticModel`

**èŒè´£**: å®šä¹‰è¯­ä¹‰æ¨¡å‹ç»“æ„

**ä¸»è¦å±æ€§**:

```java
public class SemanticModel {
    private String name;              // æ¨¡å‹åç§°
    private String description;       // æ¨¡å‹æè¿°
    private String model;            // å…³è”çš„æ•°æ®æ¨¡å‹ï¼ˆè¡¨æˆ–è§†å›¾ï¼‰
    
    private List<Entity> entities;   // å®ä½“åˆ—è¡¨ï¼ˆä¸»é”®ã€å¤–é”®ï¼‰
    private List<Dimension> dimensions; // ç»´åº¦åˆ—è¡¨ï¼ˆæ—¶é—´ã€åˆ†ç±»ã€æšä¸¾ï¼‰
    private List<Measure> measures;  // åº¦é‡åˆ—è¡¨ï¼ˆèšåˆå‡½æ•°ã€è®¡ç®—å­—æ®µï¼‰
}
```

**ç›¸å…³ç±»**:
- `Entity` - å®ä½“ï¼ˆä¸»é”®ã€å”¯ä¸€é”®ã€å¤–é”®ï¼‰
- `Dimension` - ç»´åº¦ï¼ˆæ—¶é—´ç»´åº¦ã€åˆ†ç±»ç»´åº¦ã€æšä¸¾ç»´åº¦ï¼‰
- `Measure` - åº¦é‡ï¼ˆèšåˆå‡½æ•°ã€è®¡ç®—å­—æ®µï¼‰

### 6. StreamAction æµå¼æ“ä½œ

**ä½ç½®**: `ai.dat.core.agent.data.StreamAction`

**èŒè´£**: æµå¼äº‹ä»¶å¤„ç†ï¼Œæ”¯æŒæµå¼è¾“å‡º

**äº‹ä»¶ç±»å‹**:
- `INCREMENTAL_CONTENT` - å¢é‡å†…å®¹
- `SEMANTIC_SQL` - è¯­ä¹‰ SQL
- `QUERY_SQL` - æŸ¥è¯¢ SQL
- `QUERY_DATA` - æŸ¥è¯¢æ•°æ®
- `TOOL_EXECUTION_REQUEST` - å·¥å…·æ‰§è¡Œè¯·æ±‚
- `TOOL_EXECUTION_RESULT` - å·¥å…·æ‰§è¡Œç»“æœ
- `HITL_AI_REQUEST` - äººæœºäº¤äº’ AI è¯·æ±‚
- `HITL_TOOL_APPROVAL` - äººæœºäº¤äº’å·¥å…·å®¡æ‰¹
- `MESSAGES` - æ¶ˆæ¯

---

## åã€é…ç½®ä½“ç³»

### 1. é¡¹ç›®é…ç½®æ–‡ä»¶ (dat_project.yaml)

**ä½ç½®**: é¡¹ç›®æ ¹ç›®å½•

**ç»“æ„**:

```yaml
version: 1
name: my-dat-project
description: æˆ‘çš„æ™ºèƒ½é—®æ•°é¡¹ç›®

# æ•°æ®åº“é…ç½®
db:
  provider: mysql  # æ•°æ®åº“ç±»å‹
  configuration:
    url: jdbc:mysql://localhost:3306/mydb
    username: your_username
    password: your_password
    timeout: 1 min

# LLM é…ç½®
llm:
  provider: openai
  configuration:
    api-key: your-openai-api-key
    model-name: gpt-4
    base-url: https://api.openai.com/v1
    temperature: 0.7
    max-tokens: 2000

# åµŒå…¥æ¨¡å‹é…ç½®
embedding:
  provider: bge-small-zh-v15-q
  configuration:
    # é…ç½®é¡¹æ ¹æ®ä¸åŒçš„ provider è€Œä¸åŒ

# å‘é‡å­˜å‚¨é…ç½®
embedding-store:
  provider: duckdb
  configuration:
    # é…ç½®é¡¹æ ¹æ®ä¸åŒçš„ provider è€Œä¸åŒ

# é‡æ’æ¨¡å‹é…ç½®ï¼ˆå¯é€‰ï¼‰
reranking:
  provider: ms-marco-minilm-l6-v2
  configuration:
    # é…ç½®é¡¹æ ¹æ®ä¸åŒçš„ provider è€Œä¸åŒ

# å†…å®¹å­˜å‚¨é…ç½®
content-store:
  provider: default
  configuration:
    # é…ç½®é¡¹

# Agent é…ç½®
agents:
  - name: default
    provider: agentic
    configuration:
      # Agent ç‰¹å®šé…ç½®
```

### 2. è¯­ä¹‰æ¨¡å‹é…ç½® (models/*.yaml)

**ä½ç½®**: `models/` ç›®å½•

**ç¤ºä¾‹**:

```yaml
version: 1

semantic_models:
  - name: sales_data
    description: é”€å”®æ•°æ®åˆ†ææ¨¡å‹
    model: ref('sales_table')  # å¼•ç”¨æ•°æ®æ¨¡å‹
    
    # å®ä½“å®šä¹‰
    entities:
      - name: product_id
        description: äº§å“ID
        type: primary  # primary, unique, foreign
    
    # ç»´åº¦å®šä¹‰
    dimensions:
      - name: sale_date
        description: é”€å”®æ—¥æœŸ
        type: time
        type_params:
          time_granularity: day  # day, week, month, year
      
      - name: region
        description: é”€å”®åŒºåŸŸ
        type: categorical
        enum_values:
          - value: "North"
            label: "åŒ—åŒº"
          - value: "South"
            label: "å—åŒº"
    
    # åº¦é‡å®šä¹‰
    measures:
      - name: sales_amount
        description: é”€å”®é‡‘é¢
        agg: sum  # sum, avg, count, max, min
      
      - name: order_count
        description: è®¢å•æ•°é‡
        agg: count
```

### 3. æ•°æ®æ¨¡å‹é…ç½® (schemas/*.yaml)

**ä½ç½®**: `schemas/` ç›®å½•

**ç¤ºä¾‹**:

```yaml
version: 1

data_models:
  - name: sales_table
    type: table  # table, view
    sql: |
      SELECT 
        product_id,
        sale_date,
        region,
        sales_amount
      FROM sales
      {% if user_id %}
      WHERE user_id = {{ user_id }}
      {% endif %}
    # æ”¯æŒ Jinja æ¨¡æ¿ï¼Œå®ç°æ•°æ®æƒé™æ§åˆ¶
```

### 4. ç§å­æ•°æ®é…ç½® (seeds/*.yaml)

**ä½ç½®**: `seeds/` ç›®å½•

**ç¤ºä¾‹**:

```yaml
version: 1

seeds:
  - name: sales_data
    table: sales
    file: data/sales.csv
    columns:
      - name: product_id
        type: INTEGER
      - name: sale_date
        type: DATE
      - name: region
        type: VARCHAR
      - name: sales_amount
        type: DECIMAL
```

### 5. é…ç½®ç‰¹ç‚¹

#### YAML æ ¼å¼
- äººç±»å¯è¯»ï¼Œæ˜“äºç¼–è¾‘
- æ”¯æŒæ³¨é‡Š
- å±‚æ¬¡ç»“æ„æ¸…æ™°

#### Schema éªŒè¯
- é€šè¿‡ JSON Schema éªŒè¯é…ç½®æ ¼å¼
- ç±»å‹å®‰å…¨æ£€æŸ¥
- é…ç½®é¡¹éªŒè¯

#### Jinja æ¨¡æ¿æ”¯æŒ
- æ”¯æŒå˜é‡æ›¿æ¢
- æ”¯æŒæ¡ä»¶åˆ¤æ–­
- æ”¯æŒå¾ªç¯
- å®ç°åŠ¨æ€é…ç½®ï¼ˆå¦‚æ•°æ®æƒé™ï¼‰

#### å¤šç¯å¢ƒæ”¯æŒ
- å¼€å‘ç¯å¢ƒ
- æµ‹è¯•ç¯å¢ƒ
- ç”Ÿäº§ç¯å¢ƒ
- é€šè¿‡å˜é‡æ›¿æ¢å®ç°ç¯å¢ƒåˆ‡æ¢

### 6. é…ç½®åŠ è½½æµç¨‹

```
1. è¯»å– dat_project.yaml
   â†“
2. è§£æé…ç½®ç»“æ„
   â†“
3. Schema éªŒè¯
   â†“
4. åŠ è½½æ•°æ®æ¨¡å‹ (schemas/*.yaml)
   â†“
5. åŠ è½½è¯­ä¹‰æ¨¡å‹ (models/*.yaml)
   â†“
6. é€šè¿‡å·¥å‚åˆ›å»ºç»„ä»¶
   â†“
7. åˆå§‹åŒ– ContentStore
   â†“
8. æ„å»º Agent
```

### 7. é…ç½®æœ€ä½³å®è·µ

1. **æ•æ„Ÿä¿¡æ¯**: ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–
2. **æ¨¡æ¿å¤ç”¨**: ä½¿ç”¨ Jinja æ¨¡æ¿å‡å°‘é‡å¤é…ç½®
3. **ç‰ˆæœ¬æ§åˆ¶**: é…ç½®æ–‡ä»¶çº³å…¥ç‰ˆæœ¬æ§åˆ¶
4. **ç¯å¢ƒéš”ç¦»**: ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
5. **é…ç½®éªŒè¯**: å¯åŠ¨å‰éªŒè¯é…ç½®å®Œæ•´æ€§

---

## åä¸€ã€æ€»ç»“

DAT é¡¹ç›®é‡‡ç”¨**åˆ†å±‚æ¨¡å—åŒ–æ¶æ„**ï¼Œé€šè¿‡ **SPI æœºåˆ¶**å’Œ**å·¥å‚æ¨¡å¼**å®ç°é«˜åº¦å¯æ‰©å±•çš„è®¾è®¡ã€‚æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯ï¼š

1. **Framework è€Œé Platform**: æä¾›æ¡†æ¶èƒ½åŠ›ï¼Œæ”¯æŒäºŒæ¬¡å¼€å‘
2. **é…ç½®é©±åŠ¨**: é€šè¿‡ YAML é…ç½®é©±åŠ¨æ•´ä¸ªç³»ç»Ÿï¼Œé™ä½å¼€å‘é—¨æ§›
3. **å¯æ’æ‹”æ¶æ„**: æ‰€æœ‰ç»„ä»¶é€šè¿‡ SPI æœºåˆ¶åŠ¨æ€åŠ è½½ï¼Œæ˜“äºæ‰©å±•
4. **è¯­ä¹‰å±‚æŠ½è±¡**: é€šè¿‡è¯­ä¹‰æ¨¡å‹å°†è‡ªç„¶è¯­è¨€è½¬æ¢ä¸º SQLï¼Œç¡®ä¿å‡†ç¡®æ€§

### æ ¸å¿ƒä¼˜åŠ¿

- âœ… **æ¨¡å—åŒ–**: èŒè´£æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤
- âœ… **å¯æ‰©å±•**: SPI æœºåˆ¶æ”¯æŒçµæ´»æ‰©å±•
- âœ… **é…ç½®åŒ–**: YAML é…ç½®ï¼Œæ— éœ€ç¼–ç 
- âœ… **æœ¬åœ°åŒ–**: æ”¯æŒæœ¬åœ°æ¨¡å‹ï¼Œé™ä½æˆæœ¬
- âœ… **ä¼ä¸šçº§**: æ”¯æŒ HITLã€æƒé™æ§åˆ¶ç­‰ä¼ä¸šç‰¹æ€§

### é€‚ç”¨åœºæ™¯

- ä¼ä¸šå†…éƒ¨æ•°æ®æŸ¥è¯¢å¹³å°
- BI å·¥å…·çš„è‡ªç„¶è¯­è¨€æŸ¥è¯¢å¢å¼º
- æ•°æ®åˆ†æå¸ˆçš„è‡ªåŠ©æŸ¥è¯¢å·¥å…·
- æ•°æ®äº§å“çš„æ™ºèƒ½é—®ç­”åŠŸèƒ½

---


